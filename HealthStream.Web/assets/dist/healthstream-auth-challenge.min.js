/*! healthstream-auth-challenge 09/13/2014 */
var app=angular.module("healthStreamAuth",["ngRoute","authorizationEventHandler"]);app.config(["$routeProvider",function(a){"use strict";a.when("/login",{controller:"loginController",templateUrl:"/assets/js/auth/login/auth-login.html",allow_anonymous:!0}).when("/register",{controller:"registerController",templateUrl:"/assets/js/auth/register/auth-register.html",allow_anonymous:!0}).when("/",{controller:"homeController",templateUrl:"/assets/js/home/home.html"})}]),app.factory("authService",["$http","$q","settingsService","localStorageService",function(a,b,c,d){"use strict";var e="authorization",f=d.get(e);("undefined"==typeof f||null===f)&&(f={is_authenticated:!1,username:"",token:""});var g=function(d){var e=b.defer();return a.post(c.base_url+"authentication/register",d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},h=function(g){var h=b.defer();return a.post(c.base_url+"authentication/authenticate",g).success(function(a){f.username=g.username,f.is_authenticated=!0,f.token=a,d.set(e,f),h.resolve(a)}).error(function(a,b){var c="";c=401===b?"Invalid username or password.":a,h.reject(c)}),h.promise},i=function(){return f.is_authenticated};return{register:g,login:h,is_logged_in:i}}]),angular.module("authorizationEventHandler",[]).run(["$rootScope","$location","authService","settingsService",function(a,b,c,d){"use strict";console.log("adding event handler"),a.$on("$routeChangeStart",function(a,e){c.is_logged_in()||e.allow_anonymous||b.path(d.login_route)})}]),app.controller("loginController",["$location","settingsService","authService",function(a,b,c){"use strict";var d=this;this.login_data={username:"",password:"",remember_me:!1},this.message="",this.login=function(){c.login(this.login_data).then(function(){a.path(b.homepage)},function(a){console.log(a),d.message=a})}}]),app.controller("registerController",["$location","settingsService","authService",function(a,b,c){"use strict";var d=this;this.register_data={username:"",password:"",confirm_password:"",email_address:""},this.message="",this.register=function(){c.register(this.register_data).then(function(){a.path(b.login_route)},function(a){d.message=a.error_description})}}]),app.factory("localStorageService",function(){"use strict";var a=window.localStorage,b=function(b,c){a.setItem(b,JSON.stringify(c))},c=function(b){return JSON.parse(a.getItem(b))},d=function(b){a.removeItem(b)},e=function(){a.clear()};return{set:b,get:c,remove:d,clear:e}}),app.factory("settingsService",function(){"use strict";var a="http://localhost:3000/",b="/login",c="/";return{base_url:a,login_route:b,homepage:c}}),app.controller("homeController",function(){"use strict"});